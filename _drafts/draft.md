
One of the major features that's been in my mind about Itinerant since its inception is that in some way, the worlds within the universe should be in some way constantly evolving and changing. Really it started with the idea that you should be able to plant trees in the ground and watch them grow, but that each tree should be in some way unique and should grow (or not die) based on the surrounding environmental conditions.

The more you think about this, the more complex it gets. First off, you can fairly easily determine the average amount of sunlight the plant will get if you know a few variables about the planet such as rotation speed and axial tilt, and you know where on the planet it's been planted. But of course, that's only part of the story - you also need to know the surrounding temperature, how the temperature and sunlight changes with the seasons, wind speeds, it just goes on and on. Before you know it (as I've found out these past few weeks), you're thinking about how you calculate air movements over an entire planet just to know what the surface temperature and air pressure is going to be on a single spot on the ground.

Since I've spent so much time building up the data formats, storage mediums, rendering mechanisms and building mechanics for the planets, I hadn't given much thought to how I would turn these static environments into living, breathing worlds that slowly change over time.

Recently I thought I'd add one specific metric to my planets - the surface temperature when the player is on the ground. This is when everything started to unravel for me, and it has been pretty daunting and demoralising at times.

I got off to a good start - I understand that stars emit something we refer to as flux, which is a value of energy per m2 (W/m2), and that due to the inverse square law this flux drops as distance for the star increases.

In this way, you can figure out how much solar flux actually hits a planet just by knowing the energy output of the star, the distance the planet is at from the star, and the size of the planet. You can then take into account the albedo of the planet, which helps us determine how much energy reflects back into space, and finally by taking the angle the surface of the planet is at relative to the star, you can figure out how much flux actually hits that part of the surface (eg, if you're standing at one of Earth's poles, a lot less solar flux will hit the ground compared to at the equator*).

[* there's obviously a lot more to it that this, such as the fact the sunlight has to travel through more atmosphere at the poles, but you get the idea]

I messed about with the formulae that govern these elements for quite a while, hoping I'd get a good idea of what the temperature might be at any point on a planet, and indeed I guess I did get that, but it turned out it wasn't what I wanted. When you're looking at flux values and not considering the atmosphere, you're basically left with temperature values that are more like the planet Mercury - ridiculously high on the side facing the sun, and near to zero degrees Kelvin on the dark side.

I lost track of how many hours I spent trying to account for specific heat capacity of the surface to slow the rate of temperature loss at night down (this didn't half get complicated - you have to know the mass of the material that's losing heat, so I was trying to make estimates as the mass of rock under the player's feet that might be storing heat, plus the mass of the atmosphere above the player), trying to understand how the greenhouse effect helps trap heat in at night... and then thinking, maybe I need to account for air movements as well as air moves from high to low pressure areas - maybe the dark side of the planet stays warm because air from the warm side is convecting around to the dark side?

Whatever I did, my planet with an atmosphere was excruciatingly hot on the light side, and near to zero degrees Kelvin on the dark side. I guess I had a good base for planets and asteroids without an atmosphere, which will come in handy later, but I just wanted to know the surface temperature of the first procedural planet my system had spat out and try to figure out if my player was going to die or not.

It suddenly felt a lot like I'd spent several years building a rendering and building engine and I was going to get stumped by the survival mechanics, which I thought I'd be able to hook up pretty quickly. I know I could 'fake' it somehow, but I just wanted variety and unpredictability in my systems that I feel can only come from something that's more simulated on real physics.

I even turned to AI to help. As ever (and I don't know how anyone uses AI to do anything useful in coding that actually saves time), what it gave me was complete junk. I thought it had some good ideas in there and I spent many, many hours iterating over those ideas thinking I'd get to somewhere good - in the end I had a mad planet with extremely violent winds, massive swings in temperature and just no survivability rating. The only thing that was good was that it was colder at the poles and insanely hot at the equator, so I knew my calculations were kind of doing the right thing.

in the end I had to admit something I knew at the start of this - I do not have a degree or PhD in climatology, fluid dynamics, thermal dynamics, or any of that stuff that would actually help me right now, I don't have supercomputers to simulate real weather patterns... and I don't yet have access to an AI model that can do it for me D:

But I got to thinking that really there must be some kind of solution out there that could help me, and my research of the past few weeks at least meant I'd learnt a few key words I could throw into search engines and maybe guide me to something useful. I forget which words really helped but the next time I'm at a party with a bunch of scientists I can now nod knowingly if someone says something like 'Boltzmann Constant' or 'Lapse rate', 'Relative vorticity'...

For me, it's sometimes when I kind of give up and take a step back that I then find the solution I was looking for, and in this case in came in the form of a piece of software called SpeedyWeather.

Now this managed to unfurl a whole *other* can of worms because it's written in Julia, which is a language I don't think I'd heard of before, so suddenly I traded my learning about weather with learning about Julia, and wondering if I could get it to interact with C# in a way that made sense... but what I did manage to do with SpeedyWeather is feed it my land terrain data (new word - 'Orography'!), a land-sea mask so I could tell it where water was on the planet, some parameters about the size and rotation of the planet.. and, low and behold, it started simulating some weather information for me.

I'm genuinely impressed by what it can do, especially considering it's available under an MIT license and the people involved in the project seem very, very helpful and super engaged on GitHub. Often you find these kinds of open source projects and then realise the last commit was several years ago, the issues tab has someone asking 'has this been abandoned', the one thing you really need to work doesn't, and the code is so complex that you don't stand a chance of adding what you need. Not so here. It just works, and it works well!

So here we have it. This is a bit of a milestone day because I set up a service on my dev machine that simulates the weather on my planet and consistently updates it in 30 second increments. I know wind speeds, surface pressure, and temperatures as different layers above the planet's surface and I'm recalculating it in close to real-time (with a fair bit of interpolation going on at times, to be fair).

What this means is that I now have a background service running that I can add to going forwards and keep my planet evolving in real-time. It's not just that this means I have a route to getting working weather on the planet, it means I have a way of interacting and modifying terrain and the stuff the player is building as the game progresses. I want stuff like your base to get covered in dust when it's windy and dry, or leaks to appear if it's raining. This is now possible even when the player is away from the game and it opens up a lot of doors in terms of making the universe I want to create more dynamic and 'real'.
